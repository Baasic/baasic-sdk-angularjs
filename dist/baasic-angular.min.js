!function(e){var t=e.module("baasic.baasicApi",["HALParser"]);t.config(["$provide",function(t){function n(){return"withCredentials"in new XMLHttpRequest&&!(window.ActiveXObject||"ActiveXObject"in window)}function a(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}n()||t.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(t,n,r,i,o,c){function s(e,t){e.requestId=w;var n={callback:t,message:e};v[e.requestId]=n,b(n),w+=1}function u(e){g.contentWindow.postMessage(JSON.stringify(e.message),apiUrl)}function p(e){g.push[e]}for(var d=c.all(),l="",f=0;f<d.length;f++)l+="|"+a(d[f].get_apiUrl());var h=new RegExp("^"+l.substring(1)),g=[],v={},w=0,b=p,m=e.element('<iframe src="'+apiUrl+'proxy/angular" style="display:none"></iframe>');return m.bind("load",function(){var e=g;for(g=this,b=u;e.length>0;)b(e.shift())}),o.find("body").append(m),e.element(i).bind("message",function(e){var t=e.originalEvent||e;if(t.source==g.contentWindow){var n=JSON.parse(t.data),a=v[n.requestId];a&&(delete v[n.requestId],a.callback(n.status,n.response,n.headersString))}}),function(e,n,a,r,i,o,c,u){h.test(n)?s({method:e,url:n,post:a,headers:i,timeout:o,withCredentials:c,responseType:u},r):t(e,n,a,r,i,o,c,u)}}])}]),function(e,t){function n(e){_.each(_.rest(arguments,1),function(t){e[t]=function(n,a){return e(r(a||{},{method:t,url:n}))}})}function a(e){_.each(_.rest(arguments,1),function(t){e[t]=function(n,a,i){return e(r(i||{},{method:t,url:n,data:a}))}})}t.service("baasicApiHttp",["$http","HALParser","baasicApp",function(e,t,n){var a=new t,r=i(e,a,n.get());return r.createNew=function(t){return i(e,a,t)},r}]);var r=e.extend,i=function(e,t,i){var o=i.get_apiUrl(),c=function(n){if(n){n.withCredentials=!0,n.url=o+n.url;var a=n.headers||(n.headers={});a["Content-Type"]||(a["Content-Type"]="application/json; charset=UTF-8"),a.Accept||(a.Accept="application/hal+json; charset=UTF-8");var c=i.get_accessToken();c&&(a.AUTHORIZATION=c.token_type+" "+c.access_token)}var s=e(n);return s=r(s.then(function(e){if(e.headers){var n=e.headers["Content-Type"];n&&-1!=n.toLowerCase().indexOf("application/hal+json")&&(e.data=t.parse(e.data))}}),s)};return n(c,"get","delete","head","jsonp"),a(c,"post","put"),c}}(e,t),t.provider("baasicApp",function(){var t,n={};this.create=function(a,r){var i={apiRootUrl:"api.baasic.local",apiVersion:"beta"},o=MonoSoftware.Baasic.Application.init(a,e.extend(i,r));return n[a]=o,t||(t=o),o},this.$get=function(){return{all:function(){var e=[];for(var t in n)e.push(n[t]);return e},get:function(e){return e?n[e]:t}}}})}(angular);