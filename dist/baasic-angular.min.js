!function(e){var t=e.module("baasic.baasicApi",["HALParser"]);t.config(["$provide",function(t){function n(){return"withCredentials"in new XMLHttpRequest&&!(window.ActiveXObject||"ActiveXObject"in window)}function r(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}n()||t.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(t,n,a,i,o,c){function s(e,t){e.requestId=b;var n={callback:t,message:e};w[e.requestId]=n,m(n),b+=1}function u(e){v.contentWindow.postMessage(JSON.stringify(e.message),f)}function p(e){v.push[e]}for(var l=c.all(),f=l[0].get_apiUrl(),d="",h=0;h<l.length;h++)d+="|"+r(l[h].get_apiUrl());var g=new RegExp("^"+d.substring(1)),v=[],w={},b=0,m=p,A=e.element('<iframe src="'+f+'proxy/angular" style="display:none"></iframe>');return A.bind("load",function(){var e=v;for(v=this,m=u;e.length>0;)m(e.shift())}),o.find("body").append(A),e.element(i).bind("message",function(e){var t=e.originalEvent||e;if(t.source==v.contentWindow){var n=JSON.parse(t.data),r=w[n.requestId];r&&(delete w[n.requestId],r.callback(n.status,n.response,n.headersString))}}),function(e,n,r,a,i,o,c,u){g.test(n)?s({method:e,url:n,post:r,headers:i,timeout:o,withCredentials:c,responseType:u},a):t(e,n,r,a,i,o,c,u)}}])}]),function(e,t){function n(t){e.forEach(o(arguments,1),function(e){t[e]=function(n,r){return t(c(r||{},{method:e,url:n}))}})}function r(t){e.forEach(o(arguments,1),function(e){t[e]=function(n,r,a){return t(c(a||{},{method:e,url:n,data:r}))}})}function a(e){var t=e.toLowerCase();return i(t,"http://")||i(t,"https://")}function i(e,t){return e.substring(0,t.length)===t}function o(e){return Array.prototype.slice.call(e,1)}t.service("baasicApiHttp",["$http","HALParser","baasicApp",function(e,t,n){var r=new t,a=s(e,r,n.get());return a.createNew=function(t){return s(e,r,t)},a}]);var c=e.extend,s=function(e,t,i){var o=i.get_apiUrl(),s=function(n){if(n){n.withCredentials=!0,a(n.url)||(n.url=o+n.url);var r=n.headers||(n.headers={});r["Content-Type"]||(r["Content-Type"]="application/json; charset=UTF-8"),r.Accept||(r.Accept="application/hal+json; charset=UTF-8");var s=i.get_accessToken();s&&(r.AUTHORIZATION=s.token_type+" "+s.access_token)}var u=e(n);return u=c(u.then(function(e){if(e.headers){var n=e.headers("Content-Type");n&&-1!=n.toLowerCase().indexOf("application/hal+json")&&(e.data=t.parse(e.data))}}),u)};return n(s,"get","delete","head","jsonp"),r(s,"post","put"),s}}(e,t),t.provider("baasicApp",function(){var t,n={};this.create=function(r,a){var i={apiRootUrl:"api.baasic.local",apiVersion:"beta"},o=MonoSoftware.Baasic.Application.init(r,e.extend(i,a));return n[r]=o,t||(t=o),o},this.$get=function(){return{all:function(){var e=[];for(var t in n)e.push(n[t]);return e},get:function(e){return e?n[e]:t}}}})}(angular);