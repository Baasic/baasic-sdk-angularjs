!function(e){var t=e.module("baasic.baasicApi",["HALParser"]);t.config(["$provide",function(t){function r(){return"withCredentials"in new XMLHttpRequest&&!(window.ActiveXObject||"ActiveXObject"in window)}function a(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}r()||t.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(t,r,n,i,s,c){function o(e,t){e.requestId=b;var r={callback:t,message:e};h[e.requestId]=r,P(r),b+=1}function u(e){g.contentWindow.postMessage(JSON.stringify(e.message),f)}function p(e){g.push[e]}for(var d=c.all(),f=d[0].get_apiUrl(),l="",m=0;m<d.length;m++)l+="|"+a(d[m].get_apiUrl());var v=new RegExp("^"+l.substring(1)),g=[],h={},b=0,P=p,y=e.element('<iframe src="'+f+'proxy/angular" style="display:none"></iframe>');return y.bind("load",function(){var e=g;for(g=this,P=u;e.length>0;)P(e.shift())}),s.find("body").append(y),e.element(i).bind("message",function(e){var t=e.originalEvent||e;if(t.source==g.contentWindow){var r=JSON.parse(t.data),a=h[r.requestId];a&&(delete h[r.requestId],a.callback(r.status,r.response,r.headersString))}}),function(e,r,a,n,i,s,c,u){v.test(r)?o({method:e,url:r,post:a,headers:i,timeout:s,withCredentials:c,responseType:u},n):t(e,r,a,n,i,s,c,u)}}])}]),function(e,t){"use strict";t.directive("baasicRecaptcha",["baasicRecaptchaService",function(e){return{restrict:"A",link:function(t,r){e.create(r,{theme:"clean"}),t.$on("$destroy",function(){e&&e.destroy()})}}}])}(e,t),function(e,t){function r(t){e.forEach(s(arguments,1),function(e){t[e]=function(r,a){return t(c(a||{},{method:e,url:r}))}})}function a(t){e.forEach(s(arguments,1),function(e){t[e]=function(r,a,n){return t(c(n||{},{method:e,url:r,data:a}))}})}function n(e){var t=e.toLowerCase();return i(t,"http://")||i(t,"https://")}function i(e,t){return e.substring(0,t.length)===t}function s(e){return Array.prototype.slice.call(e,1)}t.service("baasicApiHttp",["$http","HALParser","baasicApp",function(e,t,r){var a=new t,n=o(e,a,r.get());return n.createNew=function(t){return o(e,a,t)},n}]);var c=e.extend,o=function(e,t,i){var s=i.get_apiUrl(),o=function(r){if(r){r.withCredentials=!0,n(r.url)||(r.url=s+r.url);var a=r.headers||(r.headers={});a["Content-Type"]||(a["Content-Type"]="application/json; charset=UTF-8"),a.Accept||(a.Accept="application/hal+json; charset=UTF-8");var o=i.get_accessToken();o&&(a.AUTHORIZATION=o.token_type+" "+o.access_token)}var u=e(r);return u=c(u.then(function(e){if(e.headers){var r=e.headers("Content-Type");r&&-1!=r.toLowerCase().indexOf("application/hal+json")&&(e.data=t.parse(e.data))}}),u)};return r(o,"get","delete","head","jsonp"),a(o,"post","put"),o}}(e,t),function(e,t,r){"use strict";t.service("baasicApiService",["baasicConstants",function(t){function a(t){e.extend(this,t),this.sort=t.orderBy?t.orderBy+"|"+t.orderDirection:null,this.searchQuery=t.search}function n(a,n){e.isObject(a)?e.extend(this,a):n!==r?this[n]=a:this[t.keyPropertyName]=a}function i(r){r.hasOwnProperty(t.modelPropertyName)?e.extend(this,r):this[t.modelPropertyName]=r}return{findParams:function(e){return new a(e)},getParams:function(e,t){return new n(e,t)},createParams:function(e){return new i(e)},updateParams:function(e){return new i(e)},removeParams:function(e){return new i(e)}}}])}(e,t),t.provider("baasicApp",function(){var t,r={};this.create=function(a,n){var i={apiRootUrl:"api.baasic.local",apiVersion:"beta"},s=MonoSoftware.Baasic.Application.init(a,e.extend(i,n));return r[a]=s,t||(t=s),s},this.$get=function(){return{all:function(){var e=[];for(var t in r)e.push(r[t]);return e},get:function(e){return e?r[e]:t}}}}),function(e,t){"use strict";t.service("baasicRoleRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("role/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("role/{roleId}/{?embed,fields}"),create:e.parse("role"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicRoleService",["baasicApiHttp","baasicApiService","baasicConstants","baasicRoleRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r,"roleId")))},create:function(n){return e.post(a.create.expand({}),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)}}}])}(e,t),function(e,t){"use strict";t.service("baasicUserRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("user/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("user/{username}/{?embed,fields}"),create:e.parse("user"),activate:e.parse("user/activate/{activationToken}/"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicUserService",["baasicApiHttp","baasicApiService","baasicConstants","baasicUserRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r,"username")))},create:function(n){return e.post(a.create.expand({}),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)},unlock:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("unlock").href,{})},lock:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("lock").href,{})},activate:function(r){var n=t.getParams(r,"activationToken");return e.put(a.activate.expand(n),{})}}}])}(e,t),function(e,t){"use strict";t.constant("baasicConstants",{idPropertyName:"id",keyPropertyName:"key",modelPropertyName:"model"})}(e,t),function(e,t){"use strict";t.service("baasicApplicationSettingsRouteService",["baasicUriTemplateService",function(e){return{get:e.parse("application/{key}/{?embed,fields}"),update:e.parse("application/{key}/"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicApplicationSettingsService",["baasicApiHttp","baasicApiService","baasicConstants","baasicApplicationSettingsRouteService",function(e,t,r,a){return{get:function(r){return e.get(a.get.expand(t.getParams(r))).success(function(e){e.origins=e.origins||[]})},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])}}}])}(e,t),function(e,t){"use strict";t.service("baasicDynamicResourceRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("resource/{resourceName}/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("resource/{resourceName}/{id}/{?embed,fields}"),create:e.parse("resource/{resourceName}"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicDynamicResourceService",["baasicApiHttp","baasicApiService","baasicConstants","baasicDynamicResourceRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r)))},create:function(n){return e.post(a.create.expand({resourceName:n.resourceName}),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)}}}])}(e,t),function(e,t){"use strict";t.service("baasicDynamicSchemaRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("schema/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("schema/{resourceName}/{?embed,fields}"),generateSchema:e.parse("schema/generate"),create:e.parse("schema"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicDynamicSchemaService",["baasicApiHttp","baasicApiService","baasicConstants","baasicDynamicSchemaRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r,"resourceName")))},create:function(n){return e.post(a.create.expand({}),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)},generateSchema:function(n){return e.post(a.generateSchema.expand({}),t.createParams(n)[r.modelPropertyName])}}}])}(e,t),function(e,t){"use strict";t.service("baasicKeyValueRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("keyvalue/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("keyvalue/{key}/{?embed,fields}"),create:e.parse("keyvalue"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicKeyValueService",["baasicApiHttp","baasicApiService","baasicConstants","baasicKeyValueRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r)))},create:function(n){return e.post(a.create.expand(),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)}}}])}(e,t),function(e,t){"use strict";t.service("baasicValueSetItemRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("valuesetitems/set/{setName}/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("valuesetitems/set/{setName}/item/{itemKey}/{?embed,fields}"),create:e.parse("valuesetitems"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicValueSetItemService",["baasicApiHttp","baasicApiService","baasicConstants","baasicValueSetItemRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r)))},create:function(n){return e.post(a.create.expand(),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(){var a=t.removeParams(data);return e.delete(a[r.modelPropertyName].links("delete").href)}}}])}(e,t),function(e,t){"use strict";t.service("baasicValueSetRouteService",["baasicUriTemplateService",function(e){return{find:e.parse("valueset/{?searchQuery,page,rpp,sort,embed,fields}"),get:e.parse("valueset/{setName}/{?embed,fields}"),create:e.parse("valueset"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicValueSetService",["baasicApiHttp","baasicApiService","baasicConstants","baasicValueSetRouteService",function(e,t,r,a){return{find:function(r){return e.get(a.find.expand(t.findParams(r)))},get:function(r){return e.get(a.get.expand(t.getParams(r,"setName")))},create:function(n){return e.post(a.create.expand({}),t.createParams(n)[r.modelPropertyName])},update:function(a){var n=t.updateParams(a);return e.put(n[r.modelPropertyName].links("put").href,n[r.modelPropertyName])},remove:function(a){var n=t.removeParams(a);return e.delete(n[r.modelPropertyName].links("delete").href)}}}])}(e,t),function(e,t,r){"use strict";var a={};t.service("baasicAuthorizationService",["$rootScope","baasicApp",function(t,n){var i=n.get(),s=i.get_apiKey();return a[s]={},{getUser:function(){var e=i.get_user();return t.user===r&&e.user!==r&&(t.user=e.user),e.user},setUser:function(e){if(e){var r=e.accessToken;delete e.accessToken,i.set_user(e,r),e.isAuthenticated=!0,t.user=e}else i.set_user(null),a[s]={},t.user={isAuthenticated:!1}},updateUser:function(t){t.accessToken||(t.accessToken=this.getAccessToken());var r=this.getUser();e.extend(r,t),this.setUser(r)},getAccessToken:function(){return i.get_accessToken()},hasPermission:function(e){if(a[s].hasOwnProperty(e))return a[s][e];var t=this.getUser();if(t!==r){var n=!1;if(t.permissions){var i=e.split(".");if(i.length>0){var c=i[0],o=t.permissions[c];if(o)if(i.length>1){for(var u=i[1].toLowerCase(),p=0;p<o.length;p++)if(o[p].toLowerCase()==u){n=!0;break}}else n=!0}}return a[s][e]=n,n}}}}])}(e,t),function(e,t){"use strict";t.service("baasicLoginRouteService",["baasicUriTemplateService",function(e){return{login:e.parse("/login/{?embed,fields}"),parse:e.parse}}])}(e,t),function(e,t){"use strict";t.service("baasicLoginService",["baasicApiHttp","baasicLoginRouteService",function(e,t){return{login:function(r,a){var n="grant_type=password&username="+r+"&password="+a;return e({url:t.login.expand({})+"?withSession=true",method:"POST",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},loadUserData:function(r){return e.get(t.login.expand(r),{headers:{Accept:"application/json; charset=UTF-8"}})},logout:function(r,a){return e({url:t.login.expand({}),method:"DELETE",data:{token:r,type:a}})}}}])}(e,t),function(e,t){"use strict";t.service("baasicPasswordRecoveryService",["baasicApiHttp",function(e){var t="RecoverPassword";return{requestReset:function(r){return e({url:t,method:"POST",data:r})},change:function(r){return e({url:t,method:"PUT",data:r})}}}])}(e,t),function(e,t){"use strict";t.service("baasicRecaptchaService",["recaptchaKey",function(e){return{create:function(t,r){var a=t.attr("id");a||(a="recaptcha-"+1e4*Math.random(),t.attr("id",a)),Recaptcha.create(e,a,r)},challenge:function(){return Recaptcha.get_challenge()},response:function(){return Recaptcha.get_response()},reload:function(){Recaptcha.reload()},destroy:function(){Recaptcha.destroy()}}}])}(e,t),function(e,t){"use strict";t.service("baasicUriTemplateService",[function(){return{parse:function(e){return UriTemplate.parse(e)},constructTemplateUrl:function(e,t){if(!e||!e.templateText||!e.defaultUrl)throw"Invalid template configuration.";if(e.templateText){var r=null,a=null,n=t.orderBy?t.orderBy+"|"+t.orderDirection:null,i={page:t.pageNumber,rpp:t.pageSize,sort:n,searchQuery:t.search};if(e.additionalParams)for(var s in e.additionalParams){if(i[s])throw"Property"+s+" already exists in default expand configuration";i[s]=e.additionalParams[s]}r=e.templateText.expand(i),a=r.indexOf(e.defaultUrl),url=r.substr(a)}else url=defaultUrl;return url}}}])}(e,t)}(angular);