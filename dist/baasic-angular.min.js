!function(e){var t=e.module("baasic.baasicApi",["HALParser"]);t.config(["$provide",function(t){browserSupportCredentialsWithCookies()&&t.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(t,n,a,i,r,o){function s(e,t){e.requestId=l;var n={callback:t,message:e};d[e.requestId]=n,h(n),l+=1}function c(e){f.contentWindow.postMessage(JSON.stringify(e.message),p)}function u(e){f.push[e]}var p=o.get_apiUrl(),f=[],d={},l=0,h=u,g=e.element('<iframe src="'+p+'proxy/angular" style="display:none"></iframe>');return g.bind("load",function(){var e=f;for(f=this,h=c;e.length>0;)h(e.shift())}),r.find("body").append(g),e.element(i).bind("message",function(e){var t=e.originalEvent||e;if(t.source==f.contentWindow){var n=JSON.parse(t.data),a=d[n.requestId];a&&(delete d[n.requestId],a.callback(n.status,n.response,n.headersString))}}),function(e,n,a,i,r,o,c,u){0==n.indexOf(p)?s({method:e,url:n,post:a,headers:r,timeout:o,withCredentials:c,responseType:u},i):t(e,n,a,i,r,o,c,u)}}])}]),t.constant("baasicApiConfig",{apiRootUrl:"api.baasic.local",apiVersion:"beta"}),function(e,t){function n(e){_.each(_.rest(arguments,1),function(t){e[t]=function(n,a){return e(o(a||{},{method:t,url:n}))}})}function a(e){_.each(_.rest(arguments,1),function(t){e[t]=function(n,a,i){return e(o(i||{},{method:t,url:n,data:a}))}})}function i(e,t,n,a){return s(e,t,n,a)}function r(e,t,n,a){function i(){var t=e.defer(),n=t.promise;return n.success=function(e){return n.then(function(t){e(t.data,t.status,t.headers,t.config)}),n},n.error=function(e){return n.then(null,function(t){e(t.data,t.status,t.headers,t.config)}),n},t}var r=s(e,t,n,a);return r.createMockDefer=function(){var e=i(),t=e.resolve,n=e.reject;return e.resolve=function(e){t({data:e})},e.reject=function(e){n({data:e})},e},r}t.service("baasicApiHttp",["$q","$http","HALParser","baasicApp",r]),t.service("baasicSystemApiHttp",["$q","$http","HALParser","baasicSystemApp",i]);var o=e.extend,s=function(e,t,i,r,s){var c,u=new i,p=r.get_apiUrl(),f=function(e){if(e){e.withCredentials=!0,e.url=p+e.url;var n=e.headers||(e.headers={});n["Content-Type"]||(n["Content-Type"]="application/json; charset=UTF-8"),n.Accept||(n.Accept="application/hal+json; charset=UTF-8");var a=r.get_accessToken();a&&(n.AUTHORIZATION=a.token_type+" "+a.access_token)}var i=t(e);return i=o(i.then(function(e){e.data&&e.data._links&&(e.data=u.parse(e.data))}),i)};return c=s?function(e){return s(e),f(e)}:f,n(c,"get","delete","head","jsonp"),a(c,"post","put"),c}}(e,t),t.service("baasicApp",["baasicApiConfig",function(e){return MonoSoftware.Baasic.Application.init(e.apiKey,e)}]),t.service("baasicSystemApp",["systemApiConfig",function(e){return MonoSoftware.Baasic.Application.init("system",e)}]),t.constant("systemApiConfig",{apiRootUrl:"api.baasic.local",apiVersion:"beta"})}(angular);