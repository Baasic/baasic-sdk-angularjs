/*
 Baasic AngularJS SDK v2.0.0
 (c) 2014-2017 Mono Ltd.  http://baasic.com
 License: MIT
*/
!function(e){var r=e.module("baasic.api",["HALParser"]);r.config(["$provide",function(r){function t(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}"withCredentials"in new XMLHttpRequest||r.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(r,n,a,i,o,s){function c(e,r,t){r.requestId=l;var n={proxy:e,callback:t,message:r};f[r.requestId]=n,e.sendMessage(n),l+=1}function u(r){var n=r.getApiUrl(),a={proxyFrame:[],apiUrlRegex:new RegExp("^"+t(n)),sendMessage:function(e){this.proxyFrame.push(e)}},i=e.element('<iframe src="'+n+'proxy/angular" style="display:none"></iframe>');return i.bind("load",function(){var e=a.proxyFrame;for(a.proxyFrame=this,a.sendMessage=function(e){this.proxyFrame.contentWindow.postMessage(JSON.stringify(e.message),n)};e.length>0;)a.sendMessage(e.shift())}),o.find("body").append(i),a}for(var p=s.all(),d=[],f={},l=0,h=0,g=p.length;g>h;h++)d.push(u(p[h]));return e.element(i).bind("message",function(e){var r=e.originalEvent||e,t=JSON.parse(r.data),n=f[t.requestId];n&&r.source===n.proxy.proxyFrame.contentWindow&&(delete f[t.requestId],n.callback(t.status,t.response,t.headersString))}),function(e,t,n,a,i,o,s,u){for(var p=0,f=d.length;f>p;p++){var l=d[p];if(l.apiUrlRegex.test(t))return void c(l,{method:e,url:t,post:n,headers:i,timeout:o,withCredentials:s,responseType:u},a)}r(e,t,n,a,i,o,s,u)}}])}]),function(e,r,t){"use strict";function n(e){return e.substr(1,e.length-2).replace(/(?:(?:\r\n)?[ \t])+/g," ")}function a(e){if(e){var r=e.match(d);if(r&&r.length>0){var a={scheme:r[0]};if(r.length>1){for(var i={},o=1,s=r.length;s>o;o++){var c=r[o].split("=");i[c[0]]=n(c[1])}a.details=i}return a}}return t}function i(e,r){return e.substring(0,r.length)===r}function o(e){var r=e.toLowerCase();return i(r,"http://")||i(r,"https://")}function s(e){return Array.prototype.slice.call(e,1)}function c(r){e.forEach(s(arguments,1),function(e){r[e]=function(t,n){return r(p(n||{},{method:e,url:t}))}})}function u(r){e.forEach(s(arguments,1),function(e){r[e]=function(t,n,a){return r(p(a||{},{method:e,url:t,data:n}))}})}var p=e.extend,d=function(){var e="(?:(?:\\r\\n)?[ \\t])+",r="(?:[\\x21\\x23-\\x27\\x2A\\x2B\\x2D\\x2E\\x30-\\x39\\x3F\\x41-\\x5A\\x5E-\\x7A\\x7C\\x7E]+)",t='"(?:[\\x00-\\x0B\\x0D-\\x21\\x23-\\x5B\\\\x5D-\\x7F]|'+e+'|\\\\[\\x00-\\x7F])*"';return new RegExp(r+"(?:=(?:"+t+"|"+r+"))?","g")}(),f=function(e,r,t,n){function i(r){var t=n.getAccessToken();n.updateAccessToken(null),e.$broadcast("token_error",{token:t,error:r.error,errorDescription:r.error_description})}function s(e){var r=a(e("WWW-Authenticate"));if(r&&"bearer"===r.scheme.toLowerCase()){var t=r.details;if(t&&t.error)switch(t.error){case"invalid_token":i(t);break;case"invalid_request":switch(t.error_description){case"Missing or invalid session":i(t)}}}}var d=n.getApiUrl(),f=function(e){if(e){e.withCredentials=!0,o(e.url)||(e.url=d+e.url);var a=e.headers||(e.headers={});a.hasOwnProperty("Content-Type")||(a["Content-Type"]="application/json; charset=UTF-8"),a.hasOwnProperty("Accept")||(a.Accept="application/hal+json; charset=UTF-8");var i=n.getAccessToken();i&&(a.AUTHORIZATION=i.token_type+" "+i.access_token)}var c=r(e);return c=p(c.then(function(e){if(e.headers){var r=e.headers("Content-Type");r&&-1!==r.toLowerCase().indexOf("application/hal+json")&&(e.data=t.parse(e.data)),s(e.headers)}},function(e){e.headers&&s(e.headers)}).finally(function(){var e=n.getAccessToken();if(e){var r=e.sliding_window;r&&(e.expireTime=(new Date).getTime()+1e3*e.slidingWindow,n.updateAccessToken(e))}}),c)};return c(f,"get","delete","head","jsonp"),u(f,"post","put","patch"),f};r.service("baasicApiHttp",["$rootScope","$http","HALParser","baasicApp",function(e,r,t,n){var a=new t,i=f(e,r,a,n.get());return i.createNew=function(t){return f(e,r,a,t)},i}])}(e,r),function(e,r,t){"use strict";r.service("baasicApiService",["baasicConstants",function(r){function n(r){e.isObject(r)?(e.extend(this,r),r.hasOwnProperty("orderBy")&&r.hasOwnProperty("orderDirection")&&(this.sort=r.orderBy?r.orderBy+"|"+r.orderDirection:null),r.hasOwnProperty("search")&&(this.searchQuery=r.search),r.hasOwnProperty("pageNumber")&&(this.page=r.pageNumber),r.hasOwnProperty("pageSize")&&(this.rpp=r.pageSize)):this.searchQuery=r}function a(n,a,i){e.isObject(n)?e.extend(this,n):i!==t?this[i]=n:this[r.idPropertyName]=n,a!==t&&e.isObject(a)&&e.extend(this,a)}function i(t){t.hasOwnProperty(r.modelPropertyName)?e.extend(this,t):this[r.modelPropertyName]=t}return{findParams:function(e){return new n(e)},getParams:function(e,r,t){return new a(e,r,t)},createParams:function(e){return new i(e)},updateParams:function(e){return new i(e)},removeParams:function(e){return new i(e)}}}])}(e,r),function(e,r){"use strict";r.provider("baasicApp",function(){var r,t={};this.create=function(n,a){var i={apiRootUrl:"api.baasic.com",apiVersion:"beta"},o=MonoSoftware.Baasic.Application.init(n,e.extend(i,a));return t[n]=o,r||(r=o),o},this.$get=function(){return{all:function(){var e=[];for(var r in t)e.push(t[r]);return e},get:function(e){return e?t[e]:r}}}})}(e,r),function(e,r){"use strict";r.service("baasicLookupRouteService",["baasicUriTemplateService",function(e){return{get:e.parse("lookups/{?embed,fields}"),parse:e.parse}}])}(e,r),function(e,r){"use strict";r.service("baasicLookupService",["baasicApiHttp","baasicApp","baasicApiService","baasicLookupRouteService",function(e,r,t,n){function a(e,r){var t={};if(e){var n=e.split(",");for(var a in n){var i=n[a];r.hasOwnProperty(i)&&(t[i]=r[i])}}return t}return{routeService:n,get:function(r){var i=e.createHttpDefer(),o=r.embed||"role,accessAction,accessSection,snProvider";return e.get(n.get.expand(t.getParams({embed:o}))).success(function(e,r,t,n){var s=a(o,e);i.resolve({data:s,status:r,headers:t,config:n})}).error(function(e,r,t,n){i.reject({data:e,status:r,headers:t,config:n})}),i.promise}}}])}(e,r),function(e,r){"use strict";r.constant("baasicConstants",{idPropertyName:"id",modelPropertyName:"model"})}(e,r),function(e,r){"use strict";r.service("baasicUriTemplateService",[function(){return{parse:function(e){return UriTemplate.parse(e)},constructTemplateUrl:function(e,r){if(!e||!e.templateText||!e.defaultUrl)throw"Invalid template configuration.";var t,n=e.defaultUrl;if(e.templateText){var a=r.orderBy?r.orderBy+"|"+r.orderDirection:null,i={page:r.pageNumber,rpp:r.pageSize,sort:a,searchQuery:r.search};if(e.additionalParams)for(var o in e.additionalParams){if(i[o])throw"Property"+o+" already exists in default expand configuration";i[o]=e.additionalParams[o]}var s=e.templateText.expand(i),c=s.indexOf(n);t=s.substr(c)}else t=n;return t}}}])}(e,r)}(angular);